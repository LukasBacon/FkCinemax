<?php
include('../funkcie.php');

if (isset($_POST['submit'])){
    $pageUrl = $_POST['url'];
    $meno = $_POST['meno'];
    $priezvisko = $_POST['priezvisko'];
    $rocnik = $_POST['rocnik'];
    $post = $_POST['post'];
    $timy = $_POST['timy'];
    $skupina = $_POST['skupina'];
    $fileURL = "";

    $ifFile = false;
    if ( $_FILES['file']['error'] <= UPLOAD_ERR_OK ){
        $file = $_FILES['file'];
        $ext = pathinfo($file['name'], PATHINFO_EXTENSION);
        $isFile = true;
        echo $ext;
    }

    if($skupina == 'Seniori'){
        if(!$isFile){
            $fileURL = 'fotky/seniori/face.png';
        }
        else{
<<<<<<< HEAD
            $fileURL = 'seniori/'+$meno+$priezvisko+koncovka;//bez diakritiky
||||||| merged common ancestors
            $fileURL = 'seniori/'+$meno+$priezvisko+koncovka;
=======
            $fileURL = 'fotky/seniori/'.replaceSpecialChars($meno).replaceSpecialChars($priezvisko).".".$ext;
            pridajFotkuNaServer($file, $fileURL);
>>>>>>> d49c9487fc04d46ba1e66aaba7ed27df90bf1463
        }
    }
    else{
        if(!$isFile){
            $fileURL = 'fotky/pripravka/face.png';
        }
        else{
<<<<<<< HEAD
            $fileURL = 'pripravka/'+$meno+$priezvisko+koncovka;//bez diakritiky
        }    else{

    }
    /*neviem co*/
    /*foreach($_FILES["files"]["name"] as $key => $file_name){
	    $file_name=$_FILES["files"]["name"][$key];
	    $file_tmp=$_FILES["files"]["tmp_name"][$key];
	    $ext=pathinfo($file_name,PATHINFO_EXTENSION);
	    if(in_array($ext,$extension)){
	        $filename=replaceSpecialChars(basename($file_name,$ext));
	        $destination = dirname(getcwd()) . "/fotky/".$album."/".$filename."-".time().".".$ext;
	        $fileURL = "fotky/".$album."/".$filename."-".time().".".$ext;
	        if(!file_exists($destination)){
	            move_uploaded_file($file_tmp=$_FILES["files"]["tmp_name"][$key],$destination);
	            compressImage($destination);
	            pridajDoDatabazy($meno, $priezvisko, $rocnik, $post, $timy, $fileURL, $skupina);
	        }
	    }
||||||| merged common ancestors
            $fileURL = 'pripravka/'+$meno+$priezvisko+koncovka;
        }    else{

    }
    /*neviem co*/
    foreach($_FILES["files"]["name"] as $key => $file_name){
	    $file_name=$_FILES["files"]["name"][$key];
	    $file_tmp=$_FILES["files"]["tmp_name"][$key];
	    $ext=pathinfo($file_name,PATHINFO_EXTENSION);
	    if(in_array($ext,$extension)){
	        $filename=replaceSpecialChars(basename($file_name,$ext));
	        $destination = dirname(getcwd()) . "/fotky/".$album."/".$filename."-".time().".".$ext;
	        $fileURL = "fotky/".$album."/".$filename."-".time().".".$ext;
	        if(!file_exists($destination)){
	            move_uploaded_file($file_tmp=$_FILES["files"]["tmp_name"][$key],$destination);
	            compressImage($destination);
	            pridajDoDatabazy($meno, $priezvisko, $rocnik, $post, $timy, $fileURL, $skupina);
	        }
	    }
=======
            $fileURL = 'fotky/pripravka/'.replaceSpecialChars($meno).replaceSpecialChars($priezvisko).".".$ext;
            pridajFotkuNaServer($file, $fileURL);
        }  
>>>>>>> d49c9487fc04d46ba1e66aaba7ed27df90bf1463
    }
<<<<<<< HEAD
    unset($_FILES['uploadedfile']);
    header('Location: ' . $url);*/
}
/*
function compressImage($pathToImage){
	list($width, $height) = getimagesize($pathToImage);
	if ($width > $height){
		resizeImage($pathToImage, $pathToImage, 1000, 0, 100);
	}
	else{
		resizeImage($pathToImage, $pathToImage, 0, 1000, 100);
	}
}
||||||| merged common ancestors
    unset($_FILES['uploadedfile']);
    header('Location: ' . $url);
}

function compressImage($pathToImage){
	list($width, $height) = getimagesize($pathToImage);
	if ($width > $height){
		resizeImage($pathToImage, $pathToImage, 1000, 0, 100);
	}
	else{
		resizeImage($pathToImage, $pathToImage, 0, 1000, 100);
	}
}
=======

    pridajDoDatabazy($meno, $priezvisko, $rocnik, $post, $timy, $fileURL, $skupina);
>>>>>>> d49c9487fc04d46ba1e66aaba7ed27df90bf1463

    unset($_FILES['file']);
    header('Location: ' . $pageUrl);
}

function pridajFotkuNaServer($file, $targetFileURL){
    $destination = dirname(getcwd()) . "/".$targetFileURL;
    move_uploaded_file($file["tmp_name"], $destination);
}
*/
function pridajDoDatabazy($meno, $priezvisko, $rocnik, $post, $timy, $fileURL, $skupina){
	$db = napoj_db();
  	$sql =<<<EOF
		INSERT INTO Hraci (meno, priezvisko, rok_narodenia, skupina, typ_hraca, url, kluby) VALUES ("$meno", "$priezvisko", "$rocnik", "$skupina", "$post", "$fileURL", "$timy");
EOF;
  	$ret = $db->query($sql);
  	$db->close();	
}

?>